import tkinter as tk
from tkinter import ttk, filedialog, messagebox, scrolledtext
import sys
import locale
import math
import struct
import freetype
import platform
from typing import List, Tuple, Optional, Any
import winsound
import os
import subprocess
from PIL import Image, ImageTk, ImageDraw, ImageFont
from datetime import datetime

# Инициализация перевода
def get_system_language():
    lang = locale.getdefaultlocale()[0]
    return 'ru' if lang and 'ru' in lang.lower() else 'en'

LANG = get_system_language()

TRANSLATIONS = {
    'ru': {
        'title': 'TTF/OTF 2 PGF',
        'input_label': 'Выберите файл шрифта:',
        'output_label': 'Куда сохранить PGF:',
        'size_label': 'Размер шрифта:',
        'ascale_label': 'Межсимвольный интервал:',
        'convert_btn': 'Конвертировать',
        'success_msg': 'Конвертация завершена успешно!',
        'error_msg': 'Ошибка',
        'file_not_found': 'Файл не найден',
        'select_file': 'Выбрать файл',
        'save_file': 'Сохранить как...',
        'converting': 'Идет конвертация...',
        'invalid_params': 'Некорректные параметры',
        'font_settings': 'Настройки шрифта',
        'progress': 'Прогресс',
        'start_convert': 'Начало конвертации...',
        'loading_font': 'Загрузка шрифта...',
        'creating_chars': 'Создание символов...',
        'creating_pointers': 'Создание указателей...',
        'writing_file': 'Запись файла...',
        'done': 'Готово!',
        'play_sound': 'Воспроизведение звука...',
        'unsupported_format': 'Неподдерживаемый формат файла',
        'progress_label': 'Прогресс:'
    },
    'en': {
        'title': 'TTF/OTF 2 PGF',
        'input_label': 'Select font file:',
        'output_label': 'Save PGF to:',
        'size_label': 'Font size:',
        'ascale_label': 'Character spacing:',
        'convert_btn': 'Convert',
        'success_msg': 'Conversion completed successfully!',
        'error_msg': 'Error',
        'file_not_found': 'File not found',
        'select_file': 'Select file',
        'save_file': 'Save as...',
        'converting': 'Converting...',
        'invalid_params': 'Invalid parameters',
        'font_settings': 'Font Settings',
        'progress': 'Log',
        'start_convert': 'Starting conversion...',
        'loading_font': 'Loading font...',
        'creating_chars': 'Creating characters...',
        'creating_pointers': 'Creating pointers...',
        'writing_file': 'Writing file...',
        'done': 'Done!',
        'play_sound': 'Playing sound...',
        'unsupported_format': 'Unsupported file format',
        'progress_label': 'Progress:'
    }
}

def tr(key: str) -> str:
    return TRANSLATIONS[LANG].get(key, key)

def play_sound():
    try:
        if platform.system() == 'Windows':
            winsound.PlaySound('SystemAsterisk', winsound.SND_ASYNC)
        elif platform.system() == 'Linux':
            subprocess.Popen(['aplay', '-q', '/dev/urandom'], stderr=subprocess.DEVNULL)
    except:
        pass

class VChar:
    def __init__(self):
        self.idx = 0
        self.ch = 0
        self.bmp = None
        self.w = 0
        self.h = 0
        self.d = 0
        self.a = 0
        self.v = 0
        self.t = 0
        self.rle = None
        self.rlen = 0
        self.hdr = None
        self.hlen = 0
        self.sh = None

class Font2PGFConverter:
    def __init__(self, root):
        self.root = root
        self.root.title(tr('title'))
        self.root.geometry('700x600')
        self.root.resizable(False, False)
        
        # Настройка темного интерфейса
        self.set_dark_theme()
        
        # Данные шрифта
        self.magic = [0x31, 0x31, 0x35, 0x30, 0x34, 0x31, 0x30, 0x35, 0x34, 0x31, 0x30, 0x30,
	0x31, 0x30, 0x31, 0x30, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15, 0x15,
	0x15, 0x15, 0x31, 0x31, 0x30, 0x30, 0x30, 0x31, 0x30, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x34,
	0x30, 0x31, 0x30, 0x33, 0x30, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x34, 0x30, 0x31, 0x30, 0x31,
	0x34, 0x31, 0x34, 0x30, 0x34, 0x30, 0x30, 0x30, 0x33, 0x30, 0x30, 0x30,
	0x30, 0x33, 0x30, 0x30, 0x30, 0x10, 0x10, 0x30, 0x30, 0x30, 0x30, 0x30,
	0x10, 0x30, 0x30, 0x10, 0x10, 0x10, 0x34, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D, 0x0D,
	0x0D, 0x0D, 0x0D, 0x0D, 0x08, 0x08, 0x08, 0x08, 0x08, 0x08, 0x30, 0x30,
	0x34, 0x34, 0x34, 0x34, 0x34, 0x34, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30,
	0x30, 0x34, 0x34, 0x33, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30]
        self.fonthdr = bytearray([0,0,136,1,80,71,70,48,2,0,0,0,6,0,0,0,70,34,0,0,68,1,0,0,9,0,0,0,0,0,0,0,4,4,
  4,0,136,2,0,0,136,2,0,0,0,32,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,
  0,101,34,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,95,3,0,0,60,255,
  255,255,195,0,0,0,178,4,0,0,41,253,255,255,18,0,0,0,49,6,0,0,70,4,0,0,175,5,
  0,0,198,4,0,0,23,0,20,0,4,0,255,220,81,143,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
  0,0,0,0,0,0,0,0,0,68,1,0,0,16,0,0,0,4,6,0,0,32,0,0,0,32,0,0,0,192,3,0,0,192,
  3,0,0,0,0,0,0,0,0,0,0,136,0,0,0,148,3,0,0,175,0,0,0,170,0,0,0,252,0,0,0,103,
  4,0,0,20,1,0,0,199,0,0,0,57,1,0,0,59,1,0,0,62,1,0,0,105,4,0,0,63,1,0,0,79,4,
  0,0,63,1,0,0,81,4,0,0,63,1,0,0,106,4,0,0,84,1,0,0,115,1,0,0,85,1,0,0,117,1,0,
  0,109,1,0,0,87,1,0,0,110,1,0,0,86,1,0,0,110,1,0,0,88,1,0,0,110,1,0,0,176,3,0,
  0,111,1,0,0,176,3,0,0,111,1,0,0,115,4,0,0,112,1,0,0,134,0,0,0,117,1,0,0,119,
  1,0,0,120,1,0,0,148,3,0,0,122,1,0,0,94,0,0,0,152,1,0,0,199,0,0,0,152,1,0,0,
  155,2,0,0,152,1,0,0,156,2,0,0,152,1,0,0,199,3,0,0,152,1,0,0,150,4,0,0,153,1,
  0,0,181,0,0,0,159,1,0,0,120,0,0,0,175,1,0,0,175,1,0,0,184,1,0,0,151,0,0,0,
  195,1,0,0,3,2,0,0,198,1,0,0,12,2,0,0,198,1,0,0,151,3,0,0,205,1,0,0,207,1,0,0,
  214,1,0,0,196,2,0,0,215,1,0,0,162,3,0,0,237,1,0,0,146,3,0,0,237,1,0,0,148,3,
  0,0,244,1,0,0,110,3,0,0,5,2,0,0,153,0,0,0,14,2,0,0,173,1,0,0,19,2,0,0,184,2,
  0,0,19,2,0,0,96,3,0,0,19,2,0,0,199,3,0,0,31,2,0,0,73,1,0,0,49,2,0,0,12,4,0,0,
  64,2,0,0,55,0,0,0,64,2,0,0,120,0,0,0,66,2,0,0,43,4,0,0,80,2,0,0,78,2,0,0,83,
  2,0,0,204,2,0,0,85,2,0,0,154,2,0,0,85,2,0,0,155,2,0,0,87,2,0,0,204,2,0,0,101,
  2,0,0,185,2,0,0,108,2,0,0,186,2,0,0,114,2,0,0,218,2,0,0,117,2,0,0,185,2,0,0,
  119,2,0,0,185,2,0,0,119,2,0,0,200,3,0,0,121,2,0,0,182,2,0,0,121,2,0,0,185,3,
  0,0,124,2,0,0,147,2,0,0,126,2,0,0,185,2,0,0,126,2,0,0,10,4,0,0,130,2,0,0,148,
  3,0,0,131,2,0,0,131,2,0,0,132,2,0,0,184,2,0,0,132,2,0,0,193,2,0,0,132,2,0,0,
  197,2,0,0,132,2,0,0,149,3,0,0,132,2,0,0,184,3,0,0,132,2,0,0,191,3,0,0,132,2,
  0,0,207,3,0,0,133,2,0,0,132,3,0,0,136,2,0,0,186,2,0,0,136,2,0,0,108,3,0,0,
  138,2,0,0,114,4,0,0,139,2,0,0,222,2,0,0,139,2,0,0,223,2,0,0,139,2,0,0,216,3,
  0,0,140,2,0,0,185,2,0,0,142,2,0,0,107,0,0,0,149,2,0,0,158,2,0,0,153,2,0,0,
  115,4,0,0,154,2,0,0,158,2,0,0,163,2,0,0,146,3,0,0,163,2,0,0,71,4,0,0,163,2,0,
  0,148,4,0,0,169,2,0,0,213,2,0,0,169,2,0,0,214,2,0,0,169,2,0,0,150,3,0,0,169,
  2,0,0,151,3,0,0,169,2,0,0,192,3,0,0,169,2,0,0,207,3,0,0,169,2,0,0,215,3,0,0,
  169,2,0,0,4,4,0,0,169,2,0,0,97,4,0,0,170,2,0,0,186,2,0,0,170,2,0,0,216,2,0,0,
  170,2,0,0,217,2,0,0,170,2,0,0,99,3,0,0,170,2,0,0,167,3,0,0,170,2,0,0,205,3,0,
  0,174,2,0,0,217,2,0,0,179,2,0,0,214,2,0,0,179,2,0,0,216,2,0,0,179,2,0,0,189,
  3,0,0,179,2,0,0,191,3,0,0,179,2,0,0,212,3,0,0,182,2,0,0,186,3,0,0,184,2,0,0,
  223,2,0,0,184,2,0,0,224,2,0,0,184,2,0,0,98,3,0,0,184,2,0,0,195,3,0,0,184,2,0,
  0,210,3,0,0,184,2,0,0,218,3,0,0,185,2,0,0,130,3,0,0,185,2,0,0,166,3,0,0,185,
  2,0,0,133,4,0,0,186,2,0,0,108,3,0,0,186,2,0,0,100,4,0,0,186,2,0,0,123,4,0,0,
  189,2,0,0,185,2,0,0,192,2,0,0,26,3,0,0,193,2,0,0,115,1,0,0,200,2,0,0,185,3,0,
  0,208,2,0,0,184,2,0,0,208,2,0,0,149,3,0,0,210,2,0,0,148,3,0,0,216,2,0,0,183,
  2,0,0,216,2,0,0,149,3,0,0,216,2,0,0,79,4,0,0,228,2,0,0,148,3,0,0,228,2,0,0,
  115,4,0,0,228,2,0,0,150,4,0,0,231,2,0,0,148,3,0,0,234,2,0,0,166,3,0,0,234,2,
  0,0,167,3,0,0,235,2,0,0,184,2,0,0,239,2,0,0,31,3,0,0,251,2,0,0,149,3,0,0,254,
  2,0,0,103,3,0,0,255,2,0,0,103,3,0,0,255,2,0,0,162,3,0,0,5,3,0,0,184,2,0,0,8,
  3,0,0,148,3,0,0,16,3,0,0,146,3,0,0,19,3,0,0,148,3,0,0,20,3,0,0,147,3,0,0,20,
  3,0,0,148,3,0,0,20,3,0,0,149,3,0,0,21,3,0,0,185,2,0,0,22,3,0,0,146,3,0,0,22,
  3,0,0,148,3,0,0,24,3,0,0,164,3,0,0,25,3,0,0,149,3,0,0,25,3,0,0,163,3,0,0,25,
  3,0,0,151,4,0,0,29,3,0,0,100,4,0,0,36,3,0,0,190,3,0,0,36,3,0,0,192,3,0,0,38,
  3,0,0,191,3,0,0,40,3,0,0,148,3,0,0,40,3,0,0,193,3,0,0,42,3,0,0,148,3,0,0,42,
  3,0,0,149,3,0,0,42,3,0,0,121,4,0,0,42,3,0,0,132,4,0,0,43,3,0,0,214,1,0,0,43,
  3,0,0,14,3,0,0,45,3,0,0,148,3,0,0,45,3,0,0,194,3,0,0,48,3,0,0,185,2,0,0,50,3,
  0,0,219,2,0,0,50,3,0,0,184,3,0,0,50,3,0,0,185,3,0,0,50,3,0,0,169,4,0,0,54,3,
  0,0,148,3,0,0,55,3,0,0,148,3,0,0,56,3,0,0,94,4,0,0,59,3,0,0,166,3,0,0,59,3,0,
  0,167,3,0,0,63,3,0,0,29,3,0,0,64,3,0,0,192,3,0,0,68,3,0,0,148,3,0,0,69,3,0,0,
  148,3,0,0,70,3,0,0,175,3,0,0,70,3,0,0,142,4,0,0,70,3,0,0,177,4,0,0,78,3,0,0,
  149,3,0,0,92,3,0,0,183,3,0,0,97,3,0,0,146,3,0,0,97,3,0,0,148,3,0,0,99,3,0,0,
  159,3,0,0,102,3,0,0,146,3,0,0,108,3,0,0,186,3,0,0,108,3,0,0,187,3,0,0,108,3,
  0,0,171,4,0,0,110,3,0,0,186,3,0,0,114,3,0,0,231,1,0,0,119,3,0,0,41,4,0,0,121,
  3,0,0,149,3,0,0,123,3,0,0,186,3,0,0,123,3,0,0,187,3,0,0,123,3,0,0,134,4,0,0,
  123,3,0,0,139,4,0,0,123,3,0,0,169,4,0,0,127,3,0,0,26,4,0,0,128,3,0,0,149,3,0,
  0,134,3,0,0,185,2,0,0,140,3,0,0,149,3,0,0,140,3,0,0,186,3,0,0,142,3,0,0,52,4,
  0,0,143,3,0,0,148,3,0,0,144,3,0,0,146,3,0,0,144,3,0,0,148,3,0,0,144,3,0,0,
  113,4,0,0,144,3,0,0,132,4,0,0,144,3,0,0,148,4,0,0,149,3,0,0,149,3,0,0,150,3,
  0,0,147,3,0,0,151,3,0,0,148,3,0,0,154,3,0,0,146,3,0,0,165,3,0,0,148,3,0,0,
  167,3,0,0,182,3,0,0,168,3,0,0,148,3,0,0,168,3,0,0,186,3,0,0,168,3,0,0,115,4,
  0,0,168,3,0,0,120,4,0,0,168,3,0,0,146,4,0,0,168,3,0,0,147,4,0,0,168,3,0,0,
  150,4,0,0,168,3,0,0,198,4,0,0,172,3,0,0,147,3,0,0,176,3,0,0,170,0,0,0,192,3,
  0,0,149,3,0,0,196,3,0,0,24,4,0,0,198,3,0,0,161,3,0,0,200,3,0,0,146,3,0,0,200,
  3,0,0,148,3,0,0,206,3,0,0,199,2,0,0,213,3,0,0,0,2,0,0,229,3,0,0,182,2,0,0,
  229,3,0,0,149,3,0,0,241,3,0,0,183,3,0,0,249,3,0,0,192,3,0,0,0,4,0,0,222,2,0,
  0,18,4,0,0,218,2,0,0,23,4,0,0,177,3,0,0,27,4,0,0,149,3,0,0,28,4,0,0,183,3,0,
  0,29,4,0,0,149,3,0,0,45,4,0,0,26,4,0,0,212,255,255,255,52,255,255,255,219,
  255,255,255,52,255,255,255,230,255,255,255,73,255,255,255,231,255,255,255,73,
  255,255,255,231,255,255,255,113,255,255,255,239,255,255,255,73,255,255,255,
  241,255,255,255,208,253,255,255,241,255,255,255,113,255,255,255,0,0,0,0,192,
  253,255,255,0,0,0,0,180,254,255,255,0,0,0,0,224,254,255,255,0,0,0,0,0,0,0,0,
  3,0,0,0,29,255,255,255,5,0,0,0,97,255,255,255,8,0,0,0,41,253,255,255,10,0,0,
  0,196,253,255,255,10,0,0,0,68,254,255,255,10,0,0,0,162,254,255,255,10,0,0,0,
  187,254,255,255,12,0,0,0,10,255,255,255,14,0,0,0,56,254,255,255,15,0,0,0,56,
  254,255,255,15,0,0,0,10,255,255,255,16,0,0,0,148,254,255,255,16,0,0,0,152,
  254,255,255,17,0,0,0,77,254,255,255,18,0,0,0,14,254,255,255,18,0,0,0,44,254,
  255,255,18,0,0,0,61,254,255,255,20,0,0,0,188,253,255,255,20,0,0,0,221,253,
  255,255,20,0,0,0,242,253,255,255,20,0,0,0,243,253,255,255,20,0,0,0,46,254,
  255,255,20,0,0,0,51,254,255,255,20,0,0,0,57,254,255,255,20,0,0,0,80,254,255,
  255,20,0,0,0,104,254,255,255,20,0,0,0,141,254,255,255,20,0,0,0,148,254,255,
  255,20,0,0,0,171,254,255,255,20,0,0,0,21,255,255,255,21,0,0,0,229,253,255,
  255,21,0,0,0,164,254,255,255,21,0,0,0,70,255,255,255,21,0,0,0,97,255,255,255,
  22,0,0,0,139,254,255,255,22,0,0,0,163,254,255,255,24,0,0,0,186,254,255,255,
  24,0,0,0,193,254,255,255,24,0,0,0,6,255,255,255,26,0,0,0,71,254,255,255,26,0,
  0,0,94,254,255,255,28,0,0,0,108,254,255,255,29,0,0,0,42,254,255,255,29,0,0,0,
  58,254,255,255,29,0,0,0,112,255,255,255,30,0,0,0,29,255,255,255,32,0,0,0,58,
  254,255,255,32,0,0,0,31,255,255,255,32,0,0,0,105,255,255,255,33,0,0,0,86,255,
  255,255,35,0,0,0,79,254,255,255,35,0,0,0,249,254,255,255,36,0,0,0,241,254,
  255,255,37,0,0,0,29,254,255,255,37,0,0,0,26,255,255,255,37,0,0,0,86,255,255,
  255,37,0,0,0,130,255,255,255,38,0,0,0,131,254,255,255,38,0,0,0,216,254,255,
  255,39,0,0,0,30,254,255,255,39,0,0,0,99,254,255,255,39,0,0,0,137,254,255,255,
  39,0,0,0,179,254,255,255,41,0,0,0,49,255,255,255,41,0,0,0,73,255,255,255,43,
  0,0,0,82,254,255,255,43,0,0,0,99,254,255,255,44,0,0,0,187,254,255,255,45,0,0,
  0,160,254,255,255,45,0,0,0,254,254,255,255,45,0,0,0,74,255,255,255,46,0,0,0,
  8,254,255,255,46,0,0,0,172,254,255,255,47,0,0,0,22,254,255,255,47,0,0,0,53,
  254,255,255,47,0,0,0,129,254,255,255,47,0,0,0,169,254,255,255,47,0,0,0,112,
  255,255,255,48,0,0,0,242,253,255,255,48,0,0,0,247,253,255,255,48,0,0,0,53,
  254,255,255,48,0,0,0,107,254,255,255,50,0,0,0,185,254,255,255,50,0,0,0,193,
  254,255,255,50,0,0,0,199,254,255,255,51,0,0,0,213,254,255,255,51,0,0,0,215,
  254,255,255,51,0,0,0,232,254,255,255,51,0,0,0,100,255,255,255,51,0,0,0,171,
  255,255,255,52,0,0,0,45,254,255,255,52,0,0,0,103,254,255,255,52,0,0,0,172,
  254,255,255,53,0,0,0,227,253,255,255,53,0,0,0,74,254,255,255,53,0,0,0,96,254,
  255,255,53,0,0,0,114,254,255,255,53,0,0,0,156,254,255,255,53,0,0,0,171,254,
  255,255,53,0,0,0,170,255,255,255,54,0,0,0,44,254,255,255,54,0,0,0,164,254,
  255,255,54,0,0,0,167,254,255,255,54,0,0,0,171,254,255,255,54,0,0,0,183,255,
  255,255,55,0,0,0,168,255,255,255,56,0,0,0,129,254,255,255,56,0,0,0,169,254,
  255,255,56,0,0,0,168,255,255,255,58,0,0,0,57,254,255,255,58,0,0,0,182,254,
  255,255,59,0,0,0,191,254,255,255,60,0,0,0,245,253,255,255,60,0,0,0,54,254,
  255,255,60,0,0,0,223,254,255,255,61,0,0,0,130,255,255,255,62,0,0,0,67,254,
  255,255,62,0,0,0,69,254,255,255,62,0,0,0,73,254,255,255,62,0,0,0,74,254,255,
  255,62,0,0,0,108,254,255,255,62,0,0,0,194,254,255,255,63,0,0,0,109,254,255,
  255,63,0,0,0,165,254,255,255,65,0,0,0,106,254,255,255,66,0,0,0,0,254,255,255,
  66,0,0,0,110,254,255,255,67,0,0,0,52,255,255,255,67,0,0,0,112,255,255,255,68,
  0,0,0,36,255,255,255,69,0,0,0,214,254,255,255,71,0,0,0,214,254,255,255,73,0,
  0,0,116,254,255,255,74,0,0,0,97,255,255,255,74,0,0,0,194,255,255,255,75,0,0,
  0,175,255,255,255,76,0,0,0,168,255,255,255,77,0,0,0,116,254,255,255,77,0,0,0,
  169,255,255,255,79,0,0,0,120,254,255,255,79,0,0,0,190,254,255,255,79,0,0,0,
  170,255,255,255,82,0,0,0,64,254,255,255,82,0,0,0,106,254,255,255,82,0,0,0,
  171,254,255,255,82,0,0,0,188,254,255,255,83,0,0,0,103,254,255,255,83,0,0,0,
  118,254,255,255,83,0,0,0,190,254,255,255,83,0,0,0,197,254,255,255,84,0,0,0,
  233,253,255,255,84,0,0,0,97,254,255,255,84,0,0,0,126,254,255,255,84,0,0,0,
  139,254,255,255,84,0,0,0,160,254,255,255,84,0,0,0,172,254,255,255,84,0,0,0,
  190,254,255,255,84,0,0,0,196,254,255,255,84,0,0,0,198,254,255,255,84,0,0,0,
  202,254,255,255,84,0,0,0,206,254,255,255,84,0,0,0,52,255,255,255,85,0,0,0,25,
  254,255,255,85,0,0,0,93,254,255,255,85,0,0,0,190,254,255,255,86,0,0,0,247,
  254,255,255,86,0,0,0,21,255,255,255,86,0,0,0,52,255,255,255,89,0,0,0,80,253,
  255,255,89,0,0,0,234,253,255,255,89,0,0,0,4,254,255,255,89,0,0,0,14,254,255,
  255,89,0,0,0,32,254,255,255,89,0,0,0,65,254,255,255,89,0,0,0,101,254,255,255,
  89,0,0,0,118,254,255,255,89,0,0,0,124,254,255,255,90,0,0,0,100,254,255,255,
  90,0,0,0,118,254,255,255,91,0,0,0,28,254,255,255,91,0,0,0,89,254,255,255,91,
  0,0,0,94,254,255,255,91,0,0,0,107,254,255,255,91,0,0,0,117,254,255,255,91,0,
  0,0,129,254,255,255,91,0,0,0,191,254,255,255,91,0,0,0,41,255,255,255,92,0,0,
  0,142,254,255,255,92,0,0,0,151,254,255,255,93,0,0,0,48,253,255,255,93,0,0,0,
  107,254,255,255,93,0,0,0,116,254,255,255,93,0,0,0,119,254,255,255,93,0,0,0,
  152,254,255,255,93,0,0,0,175,254,255,255,93,0,0,0,104,255,255,255,96,0,0,0,
  191,255,255,255,97,0,0,0,188,255,255,255,99,0,0,0,67,255,255,255,104,0,0,0,
  40,254,255,255,104,0,0,0,72,255,255,255,111,0,0,0,146,255,255,255,123,0,0,0,
  103,255,255,255,134,0,0,0,169,255,255,255,136,0,0,0,193,255,255,255,146,0,0,
  0,118,255,255,255,146,0,0,0,168,255,255,255,195,0,0,0,68,255,255,255,119,255,
  255,255,17,0,0,0,240,255,255,255,17,0,0,0,0,0,0,0,17,0,0,0,138,0,0,0,18,0,0,
  0,144,0,0,0,17,0,0,0,145,0,0,0,17,0,0,0,150,0,0,0,17,0,0,0,114,1,0,0,17,0,0,
  0,128,1,0,0,17,0,0,0,130,1,0,0,17,0,0,0,135,1,0,0,17,0,0,0,171,1,0,0,18,0,0,
  0,173,1,0,0,17,0,0,0,244,1,0,0,17,0,0,0,39,2,0,0,17,0,0,0,115,2,0,0,17,0,0,0,
  137,2,0,0,17,0,0,0,145,2,0,0,17,0,0,0,149,2,0,0,18,0,0,0,150,2,0,0,18,0,0,0,
  152,2,0,0,17,0,0,0,161,2,0,0,17,0,0,0,163,2,0,0,17,0,0,0,164,2,0,0,17,0,0,0,
  165,2,0,0,18,0,0,0,175,2,0,0,17,0,0,0,176,2,0,0,17,0,0,0,177,2,0,0,17,0,0,0,
  180,2,0,0,18,0,0,0,181,2,0,0,18,0,0,0,183,2,0,0,17,0,0,0,184,2,0,0,17,0,0,0,
  185,2,0,0,17,0,0,0,193,2,0,0,17,0,0,0,253,2,0,0,17,0,0,0,45,3,0,0,18,0,0,0,
  76,3,0,0,18,0,0,0,82,3,0,0,17,0,0,0,105,3,0,0,17,0,0,0,113,3,0,0,18,0,0,0,
  125,3,0,0,17,0,0,0,127,3,0,0,17,0,0,0,128,3,0,0,18,0,0,0,129,3,0,0,18,0,0,0,
  131,3,0,0,17,0,0,0,132,3,0,0,17,0,0,0,133,3,0,0,17,0,0,0,137,3,0,0,18,0,0,0,
  141,3,0,0,17,0,0,0,142,3,0,0,17,0,0,0,143,3,0,0,18,0,0,0,144,3,0,0,18,0,0,0,
  146,3,0,0,17,0,0,0,147,3,0,0,17,0,0,0,148,3,0,0,17,0,0,0,149,3,0,0,17,0,0,0,
  150,3,0,0,17,0,0,0,151,3,0,0,18,0,0,0,152,3,0,0,18,0,0,0,156,3,0,0,17,0,0,0,
  167,3,0,0,18,0,0,0,171,3,0,0,17,0,0,0,172,3,0,0,17,0,0,0,174,3,0,0,18,0,0,0,
  178,3,0,0,17,0,0,0,179,3,0,0,17,0,0,0,180,3,0,0,17,0,0,0,182,3,0,0,18,0,0,0,
  207,3,0,0,17,0,0,0,220,3,0,0,18,0,0,0,224,3,0,0,17,0,0,0,36,4,0,0,17,0,0,0,
  53,4,0,0,17,0,0,0,95,4,0,0,17,0,0,0,100,4,0,0,18,0,0,0,112,4,0,0,17,0,0,0,
  126,4,0,0,17,0,0,0,127,4,0,0,17,0,0,0,129,4,0,0,17,0,0,0,130,4,0,0,18,0,0,0,
  178,4,0,0,17,0,0,0,2,1,0,0,70,4,0,0,20,1,0,0,70,4,0,0,22,1,0,0,70,4,0,0,39,1,
  0,0,70,4,0,0,40,1,0,0,70,4,0,0,56,1,0,0,70,4,0,0,58,1,0,0,70,4,0,0,61,1,0,0,
  70,4,0,0,72,1,0,0,70,4,0,0,75,1,0,0,70,4,0,0,76,1,0,0,70,4,0,0,92,1,0,0,70,4,
  0,0,93,1,0,0,70,4,0,0,137,1,0,0,70,4,0,0,141,1,0,0,70,4,0,0,159,1,0,0,70,4,0,
  0,160,1,0,0,70,4,0,0,164,1,0,0,70,4,0,0,176,1,0,0,70,4,0,0,186,1,0,0,70,4,0,
  0,194,1,0,0,70,4,0,0,205,1,0,0,70,4,0,0,247,1,0,0,70,4,0,0,1,2,0,0,70,4,0,0,
  5,2,0,0,70,4,0,0,11,2,0,0,70,4,0,0,23,2,0,0,70,4,0,0,29,2,0,0,70,4,0,0,50,2,
  0,0,70,4,0,0,64,2,0,0,70,4,0,0,69,2,0,0,70,4,0,0,88,2,0,0,70,4,0,0,101,2,0,0,
  70,4,0,0,130,2,0,0,70,4,0,0,135,2,0,0,70,4,0,0,145,2,0,0,70,4,0,0,150,2,0,0,
  70,4,0,0,152,2,0,0,70,4,0,0,157,2,0,0,70,4,0,0,161,2,0,0,70,4,0,0,185,2,0,0,
  70,4,0,0,190,2,0,0,70,4,0,0,209,2,0,0,70,4,0,0,211,2,0,0,70,4,0,0,214,2,0,0,
  70,4,0,0,216,2,0,0,70,4,0,0,222,2,0,0,70,4,0,0,224,2,0,0,70,4,0,0,225,2,0,0,
  70,4,0,0,226,2,0,0,70,4,0,0,230,2,0,0,70,4,0,0,234,2,0,0,70,4,0,0,238,2,0,0,
  70,4,0,0,243,2,0,0,70,4,0,0,244,2,0,0,70,4,0,0,245,2,0,0,70,4,0,0,248,2,0,0,
  70,4,0,0,251,2,0,0,70,4,0,0,8,3,0,0,70,4,0,0,15,3,0,0,70,4,0,0,19,3,0,0,70,4,
  0,0,21,3,0,0,70,4,0,0,27,3,0,0,70,4,0,0,28,3,0,0,70,4,0,0,30,3,0,0,70,4,0,0,
  31,3,0,0,70,4,0,0,33,3,0,0,70,4,0,0,36,3,0,0,70,4,0,0,41,3,0,0,70,4,0,0,42,3,
  0,0,70,4,0,0,43,3,0,0,70,4,0,0,44,3,0,0,70,4,0,0,46,3,0,0,70,4,0,0,50,3,0,0,
  70,4,0,0,53,3,0,0,70,4,0,0,56,3,0,0,70,4,0,0,61,3,0,0,70,4,0,0,66,3,0,0,70,4,
  0,0,67,3,0,0,70,4,0,0,73,3,0,0,70,4,0,0,87,3,0,0,70,4,0,0,94,3,0,0,70,4,0,0,
  98,3,0,0,70,4,0,0,99,3,0,0,70,4,0,0,102,3,0,0,70,4,0,0,106,3,0,0,70,4,0,0,
  128,3,0,0,70,4,0,0,133,3,0,0,70,4,0,0,136,3,0,0,70,4,0,0,139,3,0,0,70,4,0,0,
  140,3,0,0,70,4,0,0,144,3,0,0,70,4,0,0,147,3,0,0,70,4,0,0,149,3,0,0,70,4,0,0,
  151,3,0,0,70,4,0,0,152,3,0,0,70,4,0,0,155,3,0,0,70,4,0,0,161,3,0,0,70,4,0,0,
  171,3,0,0,70,4,0,0,172,3,0,0,70,4,0,0,173,3,0,0,70,4,0,0,174,3,0,0,70,4,0,0,
  184,3,0,0,70,4,0,0,186,3,0,0,70,4,0,0,187,3,0,0,70,4,0,0,193,3,0,0,70,4,0,0,
  195,3,0,0,70,4,0,0,204,3,0,0,70,4,0,0,218,3,0,0,70,4,0,0,222,3,0,0,70,4,0,0,
  223,3,0,0,70,4,0,0,224,3,0,0,70,4,0,0,225,3,0,0,70,4,0,0,232,3,0,0,70,4,0,0,
  235,3,0,0,70,4,0,0,237,3,0,0,70,4,0,0,238,3,0,0,70,4,0,0,247,3,0,0,70,4,0,0,
  250,3,0,0,70,4,0,0,6,4,0,0,70,4,0,0,13,4,0,0,70,4,0,0,15,4,0,0,70,4,0,0,20,4,
  0,0,70,4,0,0,27,4,0,0,70,4,0,0,51,4,0,0,70,4,0,0,83,4,0,0,70,4,0,0,96,4,0,0,
  70,4,0,0,112,4,0,0,70,4,0,0,114,4,0,0,70,4,0,0,121,4,0,0,70,4,0,0,122,4,0,0,
  70,4,0,0,127,4,0,0,70,4,0,0,128,4,0,0,70,4,0,0,131,4,0,0,70,4,0,0,144,4,0,0,
  70,4,0,0,151,4,0,0,70,4,0,0,164,4,0,0,70,4,0,0,174,4,0,0,70,4,0,0,180,4,0,0,
  70,4,0,0,190,4,0,0,70,4,0,0,244,5,0,0,70,4,0,0,249,5,0,0,70,4,0,0,49,6,0,0,
  70,4,0,0,32,0,33,0,34,0,35,0,36,0,37,0,38,0,39,0,40,0,41,0,42,0,43,0,44,0,45,
  0,46,0,47,0,48,0,49,0,50,0,51,0,52,0,53,0,54,0,55,0,56,0,57,0,58,0,59,0,60,0,
  61,0,62,0,63,0,64,0,65,0,66,0,67,0,68,0,69,0,70,0,71,0,72,0,73,0,74,0,75,0,
  76,0,77,0,78,0,79,0,80,0,81,0,82,0,83,0,84,0,85,0,86,0,87,0,88,0,89,0,90,0,
  91,0,92,0,93,0,94,0,95,0,96,0,97,0,98,0,99,0,100,0,101,0,102,0,103,0,104,0,
  105,0,106,0,107,0,108,0,109,0,110,0,111,0,112,0,113,0,114,0,115,0,116,0,117,
  0,118,0,119,0,120,0,121,0,122,0,123,0,124,0,125,0,126,0,160,0,161,0,162,0,
  163,0,164,0,165,0,166,0,167,0,168,0,169,0,170,0,171,0,172,0,173,0,174,0,175,
  0,176,0,177,0,178,0,179,0,180,0,181,0,182,0,183,0,184,0,185,0,186,0,187,0,
  188,0,189,0,190,0,191,0,192,0,193,0,194,0,195,0,196,0,197,0,198,0,199,0,200,
  0,201,0,202,0,203,0,204,0,205,0,206,0,207,0,208,0,209,0,210,0,211,0,212,0,
  213,0,214,0,215,0,216,0,217,0,218,0,219,0,220,0,221,0,222,0,223,0,224,0,225,
  0,226,0,227,0,228,0,229,0,230,0,231,0,232,0,233,0,234,0,235,0,236,0,237,0,
  238,0,239,0,240,0,241,0,242,0,243,0,244,0,245,0,246,0,247,0,248,0,249,0,250,
  0,251,0,252,0,253,0,254,0,255,0,82,1,83,1,96,1,97,1,120,1,146,1,198,2,220,2,
  1,3,6,3,8,3,56,3,1,4,2,4,3,4,4,4,5,4,6,4,7,4,8,4,9,4,10,4,11,4,12,4,14,4,15,
  4,16,4,17,4,18,4,19,4,20,4,21,4,22,4,23,4,24,4,25,4,26,4,27,4,28,4,29,4,30,4,
  31,4,32,4,33,4,34,4,35,4,36,4,37,4,38,4,39,4,40,4,41,4,42,4,43,4,44,4,45,4,
  46,4,47,4,48,4,49,4,50,4,51,4,52,4,53,4,54,4,55,4,56,4,57,4,58,4,59,4,60,4,
  61,4,62,4,63,4,64,4,65,4,66,4,67,4,68,4,69,4,70,4,71,4,72,4,73,4,74,4,75,4,
  76,4,77,4,78,4,79,4,81,4,82,4,83,4,84,4,85,4,86,4,87,4,88,4,89,4,90,4,91,4,
  92,4,94,4,95,4,144,4,145,4,192,4,19,32,20,32,24,32,25,32,26,32,28,32,29,32,
  30,32,32,32,33,32,34,32,38,32,48,32,57,32,58,32,172,32,22,33,34,33,6,34,25,
  34,26,34,30,34,72,34,96,34,100,34,101,34,0,2,8,24,64,160,128,129,3,8,18,40,
  88,192,160,129,131,7,16,34,72,152,64,161,130,133,11,24,50,104,216,192,161,
  131,135,15,32,66,136,24,65,162,132,137,19,40,82,168,88,193,162,133,139,23,48,
  98,200,152,65,163,134,141,27,56,114,232,216,193,163,135,143,31,64,130,8,25,
  66,164,136,145,35,72,146,40,89,194,164,137,147,39,80,162,72,153,66,165,138,
  149,43,88,178,104,217,194,165,139,151,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,95,192,132,17,51,134,76,25,51,103,208,
  164,81,179,134,77,27,55,111,224,196,145,51,135,78,29,59,119,240,228,209,179,
  135,79,31,63,127,0,5,18,52,136,80,33,67,135,16,37,82,180,136,81,35,71,143,32,
  69,146,52,137,82,37,75,151,48,101,210,180,137,83,39,79,159,64,133,18,53,138,
  84,41,83,167,80,165,82,181,138,85,43,87,175,96,197,146,53,139,86,45,91,183,
  112,229,210,181,139,87,47,95,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,2,246,255,255,255,255,255,255,255,255,255,255,255,255,
  255,193,132,253,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,195,254,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  19,251,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,127,177,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,111,236,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,143,253,255,255,255,
  63,178,255,201,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  202,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,151,49,
  107,230,236,25,180,104,210,166,81,171,102,237,255,53,108,217,180,109,227,214,
  205,219,55,112,225,196,141,35,87,206,220,57,116,233,212,173,99,215,206,221,
  59,120,241,228,205,163,87,207,222,61,124,249,244,237,227,215,207,223,63,128,
  1,5,14,36,88,208,224,65,132,9,21,46,100,216,208,225,67,136,17,37,78,164,88,
  209,226,69,140,255,51,106,220,200,177,163,199,143,32,67,138,28,73,242,127,73,
  147,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,39,81,
  254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,41,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,87,185,
  242,255,255,255,44,91,186,252,255,18,102,204,255,50,103,210,252,255,255,127,
  205,255,255,255,255,255,255,255,255,255,255,54,255,255,255,255,255,255,255,
  255,255,111,226,252,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,159,243,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,191,206,255,255,255,255,255,255,255,255,255,255,255,255,239,252,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,63,207,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,123,250,252,255,255,255,207,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,64,255,255,255,255,255,255,255,255,255,255,255,255,
  255,255,255,255,255,255,255,255,255,255,255,255,255,255,65,255,255,255,47,
  116,40,0])
        self.current_font_path = None
        
        # Переменные GUI
        self.input_file = tk.StringVar()
        self.output_file = tk.StringVar()
        self.font_size = tk.IntVar(value=24)
        self.ascale = tk.DoubleVar(value=1.0)
        
        # Фиксированные параметры для тени
        self.blur = 2.0
        self.intensity = 0.8
        
        self.create_widgets()
    
    def set_dark_theme(self):
        self.root.configure(bg='#2d2d2d')
        style = ttk.Style()
        style.theme_use('clam')
        
        # Настройка цветов
        style.configure('.', background='#2d2d2d', foreground='white')
        style.configure('TLabel', background='#2d2d2d', foreground='white')
        style.configure('TFrame', background='#2d2d2d')
        style.configure('TButton', background='#3d3d3d', foreground='white', borderwidth=1)
        style.configure('TEntry', fieldbackground='#3d3d3d', foreground='white')
        style.configure('TSpinbox', fieldbackground='#3d3d3d', foreground='white', arrowsize=12, arrowcolor='white')
        style.configure('TLabelFrame', background='#2d2d2d', foreground='white')
        style.configure('TLabelframe.Label', background='#2d2d2d', foreground='white')
        style.configure('Vertical.TScrollbar', background='#3d3d3d')
        style.configure('Horizontal.TProgressbar', background='#4CAF50', troughcolor='#3d3d3d')
        
        style.map('TButton',
                 background=[('active', '#4d4d4d'), ('pressed', '#1d1d1d')],
                 foreground=[('active', 'white'), ('pressed', 'white')])
        
        style.map('TEntry',
                 fieldbackground=[('active', '#4d4d4d')],
                 foreground=[('active', 'white')])
        
        style.map('TSpinbox',
                 fieldbackground=[('active', '#4d4d4d')],
                 foreground=[('active', 'white')],
                 arrowcolor=[('active', 'white')])
    
    def create_widgets(self):
        # Ввод файла
        ttk.Label(self.root, text=tr('input_label')).pack(pady=(10, 0), anchor='w', padx=10)
        input_frame = ttk.Frame(self.root)
        input_frame.pack(fill='x', padx=10)
        ttk.Entry(input_frame, textvariable=self.input_file, width=40).pack(side='left', fill='x', expand=True)
        ttk.Button(input_frame, text=tr('select_file'), command=self.select_input_file).pack(side='right')
        
        # Вывод файла
        ttk.Label(self.root, text=tr('output_label')).pack(pady=(10, 0), anchor='w', padx=10)
        output_frame = ttk.Frame(self.root)
        output_frame.pack(fill='x', padx=10)
        ttk.Entry(output_frame, textvariable=self.output_file, width=40).pack(side='left', fill='x', expand=True)
        ttk.Button(output_frame, text=tr('save_file'), command=self.select_output_file).pack(side='right')
        
        # Настройки шрифта
        font_frame = ttk.LabelFrame(self.root, text=tr('font_settings'))
        font_frame.pack(fill='x', padx=10, pady=10)
        
        ttk.Label(font_frame, text=tr('size_label')).grid(row=0, column=0, sticky='w', padx=5, pady=2)
        size_spin = ttk.Spinbox(font_frame, from_=8, to=100, textvariable=self.font_size, width=5)
        size_spin.grid(row=0, column=1, sticky='w', padx=5, pady=2)
        
        ttk.Label(font_frame, text=tr('ascale_label')).grid(row=1, column=0, sticky='w', padx=5, pady=2)
        ascale_spin = ttk.Spinbox(font_frame, from_=0.25, to=2.0, increment=0.1, textvariable=self.ascale, width=5)
        ascale_spin.grid(row=1, column=1, sticky='w', padx=5, pady=2)
        
        # Лог конвертации
        log_frame = ttk.LabelFrame(self.root, text=tr('progress'))
        log_frame.pack(fill='both', expand=True, padx=10, pady=(10, 5))
        
        self.log = scrolledtext.ScrolledText(
            log_frame, 
            height=12, 
            wrap=tk.WORD, 
            bg='#252525', 
            fg='white',
            font=('Consolas', 10),
            insertbackground='white'
        )
        self.log.pack(fill='both', expand=True, padx=5, pady=5)
        
        # Настройка тегов для цветного вывода
        self.log.tag_config('info', foreground='#4CAF50')  # Зеленый для информационных сообщений
        self.log.tag_config('warning', foreground='#FFC107')  # Желтый для предупреждений
        self.log.tag_config('error', foreground='#F44336')  # Красный для ошибок
        self.log.tag_config('success', foreground='#00BCD4')  # Голубой для успешных операций
        self.log.tag_config('debug', foreground='#9E9E9E')  # Серый для отладочной информации
        self.log.tag_config('timestamp', foreground='#9C27B0')  # Фиолетовый для временных меток
        
        # Прогресс бар
        progress_frame = ttk.Frame(self.root)
        progress_frame.pack(fill='x', padx=10, pady=(0, 10))
        ttk.Label(progress_frame, text=tr('progress_label')).pack(side='left')
        self.progress_var = tk.DoubleVar()
        self.progress_bar = ttk.Progressbar(
            progress_frame, 
            variable=self.progress_var, 
            maximum=100, 
            style='Horizontal.TProgressbar',
            length=200
        )
        self.progress_bar.pack(side='right', fill='x', expand=True, padx=5)
        
        # Кнопка конвертации
        ttk.Button(self.root, text=tr('convert_btn'), command=self.convert).pack(pady=(0, 10))
    
    def update_progress(self, value):
        self.progress_var.set(value)
        self.root.update_idletasks()
    
    def log_message(self, message, level='info'):
        timestamp = datetime.now().strftime("%H:%M:%S")
        self.log.insert(tk.END, f"[{timestamp}] ", 'timestamp')
        self.log.insert(tk.END, message + "\n", level)
        self.log.see(tk.END)
        self.root.update()
    
    def select_input_file(self):
        file = filedialog.askopenfilename(filetypes=[("Font files", "*.ttf;*.otf"), ("TTF files", "*.ttf"), ("OTF files", "*.otf"), ("All files", "*.*")])
        if file:
            # Проверка расширения файла
            ext = os.path.splitext(file)[1].lower()
            if ext not in ('.ttf', '.otf'):
                messagebox.showerror(tr('error_msg'), tr('unsupported_format'))
                return
                
            self.input_file.set(file)
            self.current_font_path = file
            
            # Обновляем путь для сохранения PGF
            base_name = os.path.splitext(os.path.basename(file))[0]
            dir_name = os.path.dirname(file)
            new_pgf_path = os.path.join(dir_name, f"{base_name}.pgf")
            self.output_file.set(new_pgf_path)
    
    def select_output_file(self):
        initial_file = self.output_file.get() if self.output_file.get() else ""
        file = filedialog.asksaveasfilename(
            defaultextension=".pgf", 
            filetypes=[("PGF files", "*.pgf"), ("All files", "*.*")],
            initialfile=initial_file
        )
        if file:
            self.output_file.set(file)
    
    def buildrle_add(self, x: bytearray, v: int, i: int) -> int:
        if x is None:
            return i + 1
        if i & 1:
            x[i // 2] |= (v << 4) & 0xFF
        else:
            x[i // 2] |= v & 0x0F
        return i + 1
    
    def buildrle_int(self, x: Optional[bytearray], p: List[int], l: int) -> int:
        i = 0
        j = 0
        while j < l:
            k = j
            while k < l and (k - j) < 8:
                if p[k] != p[j]:
                    break
                k += 1
            k -= j
            
            if k > 1:  # smear
                i = self.buildrle_add(x, k - 1, i)
                i = self.buildrle_add(x, p[j], i)
                j += k
            else:  # copy
                k = j
                while k < (l - 1) and (k - j) < 8:
                    if p[k] == p[k + 1]:
                        break
                    k += 1
                if k == l - 1 and (k - j) < 8:
                    k += 1
                if k == j:
                    raise ValueError("RLE encoding error")
                i = self.buildrle_add(x, 16 - (k - j), i)
                while j < k:
                    i = self.buildrle_add(x, p[j], i)
                    j += 1
        return (i + 1) // 2
    
    def buildrle(self, p: List[int], l: int) -> Tuple[bytearray, int]:
        rlen = self.buildrle_int(None, p, l)
        x = bytearray(rlen)
        self.buildrle_int(x, p, l)
        return x, rlen
    
    def putv(self, n: int, p: bytearray, b: int, v: int) -> int:
        for i in range(n):
            if v & 1:
                p[b // 8] |= 1 << (b % 8)
            else:
                p[b // 8] &= ~(1 << (b % 8))
            v >>= 1
            b += 1
        return b
    
    def packchar(self, v: VChar) -> None:
        tbmp = [0] * (v.w * v.h)
        for j in range(v.h):
            for i in range(v.w):
                tbmp[i * v.h + j] = v.bmp[j * v.w + i]
        
        v.rle, v.rlen = self.buildrle(v.bmp, v.w * v.h)
        trle, trlen = self.buildrle(tbmp, v.w * v.h)
        
        if v.rlen > trlen:
            v.rle = trle
            v.rlen = trlen
            v.t = 2
        else:
            v.t = 1
        
        i = 0
        v.hlen = 12 if v.idx >= 0 else 6
        v.hdr = bytearray(v.hlen)
        
        if v.v >= 35:
            v.v = 35
        
        i = self.putv(14, v.hdr, i, v.rlen + v.hlen)
        i = self.putv(7, v.hdr, i, v.w)
        i = self.putv(7, v.hdr, i, v.h)
        i = self.putv(7, v.hdr, i, v.d)
        i = self.putv(7, v.hdr, i, v.a)
        i = self.putv(2, v.hdr, i, v.t)
        
        if v.hlen == 12:
            i = self.putv(1, v.hdr, i, 1)
            i = self.putv(4, v.hdr, i, 7)
            i = self.putv(6, v.hdr, i, self.magic[v.idx])
            i = self.putv(9, v.hdr, i, v.idx)
            i = self.putv(8, v.hdr, i, 0x00)
            i = self.putv(8, v.hdr, i, 0x00)
            i = self.putv(8, v.hdr, i, 0x00)
            i = self.putv(2, v.hdr, i, 0x0)
            i = self.putv(6, v.hdr, i, v.v)
        else:
            i = self.putv(1, v.hdr, i, 0)
            i = self.putv(3, v.hdr, i, 0)
        
        if v.sh:
            self.packchar(v.sh)
    
    def sqrf(self, x: float) -> float:
        return x * x
    
    def blurpass(self, b: List[int], w: int, h: int, r: float, s: float) -> None:
        c = [0.0] * (w * h)
        d = [0.0] * (w * h)
        m = int(2.0 * r + 0.5)
        k = [0.0] * (2 * m + 1)
        rf = s / (r * 1.77245)
        
        for j in range(h):
            for i in range(w):
                c[j * w + i] = b[j * w + i]
        
        for t in range(-m, m + 1):
            k[t + m] = rf * math.exp(-self.sqrf(t / r))
        
        for j in range(h):
            for i in range(w):
                x = 0.0
                for t in range(-m, m + 1):
                    if 0 <= (t + i) < w:
                        x += c[j * w + (t + i)] * k[t + m]
                d[j * w + i] = x
        
        for j in range(h):
            for i in range(w):
                x = 0.0
                for t in range(-m, m + 1):
                    if 0 <= (t + j) < h:
                        x += d[(t + j) * w + i] * k[t + m]
                c[j * w + i] = x
        
        for j in range(h):
            for i in range(w):
                val = c[j * w + i] + 0.5
                val = max(0.0, min(15.0, val))
                b[j * w + i] = int(val)
    
    def createchars(self, face: Any, sh_face: Any) -> Tuple[List[VChar], int]:
        n = struct.unpack_from('<I', self.fonthdr, 0x14)[0]
        v = [VChar() for _ in range(n)]
        
        char_codes = struct.unpack_from(f'<{n}H', self.fonthdr, 0x1760)
        
        # First pass: find the maximum height
        max_height = 0
        for i in range(n):
            face.set_char_size(0, self.font_size.get() * 64, 0, 96)
            face.load_char(char_codes[i], freetype.FT_LOAD_DEFAULT)
            face.glyph.render(freetype.FT_RENDER_MODE_NORMAL)
            
            bitmap = face.glyph.bitmap
            if bitmap.rows > max_height:
                max_height = bitmap.rows
        
        # Second pass: process all glyphs
        for i in range(n):
            self.update_progress((i / n) * 50)  # 0-50% для создания символов
            v[i].idx = i
            v[i].ch = char_codes[i]
            v[i].sh = VChar()
            v[i].sh.idx = -1
            v[i].sh.ch = 0
            self.loadchar(v[i], face, sh_face, max_height)  # Modified to pass max_height
            self.packchar(v[i])
        
        return v, n

    def loadchar(self, v: VChar, face: Any, sh_face: Any, max_height: int) -> None:
        face.set_char_size(0, self.font_size.get() * 64, 0, 96)
        face.load_char(v.ch, freetype.FT_LOAD_DEFAULT)
        face.glyph.render(freetype.FT_RENDER_MODE_NORMAL)
        
        bitmap = face.glyph.bitmap
        v.w = bitmap.width
        v.h = bitmap.rows
        v.a = face.glyph.bitmap_top
        v.d = face.glyph.bitmap_left
        
        # Рассчитываем advance с учётом ширины символа
        advance = face.glyph.advance.x >> 6  # Переводим из 26.6 формата в пиксели
        v.v = max(advance, v.w)  # advance не может быть меньше ширины символа
        v.v = int(v.v * self.ascale.get() + 0.5)  # Применяем масштабирование
        
        # Увеличиваем advance для "широких" символов
        #wide_chars = {'д', 'ц', 'ш', 'щ', 'ф', 'ы', 'л'}
        #if chr(v.ch) in wide_chars:
        #    v.v += 2
        
        if not v.w or not v.h:
            v.bmp = [0]
        else:
            # Обрезка пустых областей и центрирование
            original_bmp = [0] * (v.w * v.h)
            buffer = bitmap.buffer
            for j in range(v.h):
                for i in range(v.w):
                    original_bmp[j * v.w + i] = buffer[j * bitmap.pitch + i] >> 4
            
            min_x, min_y = v.w, v.h
            max_x, max_y = 0, 0
            for y in range(v.h):
                for x in range(v.w):
                    if original_bmp[y * v.w + x] > 0:
                        if x < min_x: min_x = x
                        if x > max_x: max_x = x
                        if y < min_y: min_y = y
                        if y > max_y: max_y = y
            
            glyph_width = max_x - min_x + 1 if max_x >= min_x else 0
            glyph_height = max_y - min_y + 1 if max_y >= min_y else 0
            
            if glyph_width > 0 and glyph_height > 0:
                glyph_bmp = [0] * (glyph_width * glyph_height)
                for y in range(glyph_height):
                    for x in range(glyph_width):
                        glyph_bmp[y * glyph_width + x] = original_bmp[(min_y + y) * v.w + (min_x + x)]
                
                new_height = max_height
                new_width = glyph_width
                y_offset = (new_height - glyph_height) // 2
                
                v.bmp = [0] * (new_width * new_height)
                for y in range(glyph_height):
                    for x in range(glyph_width):
                        if 0 <= (y + y_offset) < new_height:
                            v.bmp[(y + y_offset) * new_width + x] = glyph_bmp[y * glyph_width + x]
                
                v.w = new_width
                v.h = new_height
                v.d += min_x  # Корректируем bearingX
                v.a = v.a - min_y + y_offset  # Корректируем bearingY
            else:
                v.bmp = [0] * (1 * max_height)
                v.w = 1
                v.h = max_height
        
        # Обработка тени (оставляем без изменений)
        sh_face.set_char_size(0, (self.font_size.get() // 2) * 64, 0, 96)
        sh_face.load_char(v.ch, freetype.FT_LOAD_DEFAULT)
        sh_face.glyph.render(freetype.FT_RENDER_MODE_NORMAL)
        
        sh_bitmap = sh_face.glyph.bitmap
        v.sh.w = sh_bitmap.width + 8
        v.sh.h = sh_bitmap.rows + 8
        v.sh.a = 4 + sh_face.glyph.bitmap_top
        v.sh.d = -4 + sh_face.glyph.bitmap_left
        
        v.sh.bmp = [0] * (v.sh.w * v.sh.h)
        sh_buffer = sh_bitmap.buffer
        
        for j in range(v.sh.h - 8):
            for i in range(v.sh.w - 8):
                if j < sh_bitmap.rows and i < sh_bitmap.width:
                    v.sh.bmp[(j + 4) * v.sh.w + (i + 4)] = sh_buffer[j * sh_bitmap.pitch + i] >> 4
        
        self.blurpass(v.sh.bmp, v.sh.w, v.sh.h, self.blur, self.intensity)
    
    def createptrs(self, v: List[VChar], n: int) -> Tuple[bytearray, int, int]:
        ds = 0
        pl = 0
        
        for i in range(n):
            ds += v[i].rlen + v[i].hlen + v[i].sh.rlen + v[i].sh.hlen
            ds = (ds + 3) & ~3
        
        while (4 << pl) < ds:
            pl += 1
        
        s = ((pl * n + 31) // 32) * 4
        p = bytearray(s)
        
        ds = 0
        j = 0
        for i in range(n):
            self.update_progress(50 + (i / n) * 20)  # 50-70% для создания указателей
            val = ds // 4
            for bit in range(pl):
                if val & (1 << bit):
                    p[j // 8] |= 1 << (j % 8)
                j += 1
            
            ds += v[i].rlen + v[i].hlen + v[i].sh.rlen + v[i].sh.hlen
            ds = (ds + 3) & ~3
        
        return p, s, pl
    
    def fixupheader(self, name: str, style: str, l: int) -> None:
        name_bytes = name.encode('ascii') if isinstance(name, str) else name
        style_bytes = style.encode('ascii') if isinstance(style, str) else style
        
        if len(name_bytes) > 64:
            name_bytes = name_bytes[:64]
        if len(style_bytes) > 64:
            style_bytes = style_bytes[:64]
        
        self.fonthdr[0x35:0x35+len(name_bytes)] = name_bytes
        self.fonthdr[0x75:0x75+len(style_bytes)] = style_bytes
        
        struct.pack_into('<I', self.fonthdr, 0x1C, l)
    
    def convert(self):
        if not self.input_file.get():
            messagebox.showerror(tr('error_msg'), tr('file_not_found'))
            return
        
        try:
            # Проверка расширения файла
            ext = os.path.splitext(self.input_file.get())[1].lower()
            if ext not in ('.ttf', '.otf'):
                messagebox.showerror(tr('error_msg'), tr('unsupported_format'))
                return
                
            self.log_message(tr('start_convert'), 'info')
            self.root.config(cursor='watch')
            self.update_progress(0)
            self.root.update()
            
            self.log_message(tr('loading_font'), 'info')
            face = freetype.Face(self.input_file.get())
            sh_face = freetype.Face(self.input_file.get())
            self.update_progress(5)
            
            self.log_message(tr('creating_chars'), 'info')
            v, n = self.createchars(face, sh_face)
            self.update_progress(50)
            
            self.log_message(tr('creating_pointers'), 'info')
            p, s, l = self.createptrs(v, n)
            self.update_progress(70)
            
            ts = face.style_name if face.style_name else ""
            family_name = face.family_name if face.family_name else ""
            self.fixupheader(family_name, ts, l)
            
            self.log_message(tr('writing_file'), 'info')
            with open(self.output_file.get(), 'wb') as f:
                f.write(self.fonthdr[:16504])
                f.write(p)
                
                for i in range(n):
                    self.update_progress(70 + (i / n) * 30)  # 70-100% для записи файла
                    f.write(v[i].hdr)
                    f.write(v[i].rle)
                    f.write(v[i].sh.hdr)
                    f.write(v[i].sh.rle)
                    
                    pad_len = (4 - ((v[i].rlen + v[i].hlen + v[i].sh.rlen + v[i].sh.hlen) % 4)) % 4
                    f.write(b'\x00' * pad_len)
            
            self.update_progress(100)
            self.log_message(tr('done'), 'success')
            play_sound()
            messagebox.showinfo(tr('success_msg'), tr('success_msg'))
        
        except Exception as e:
            self.log_message(f"{tr('error_msg')}: {str(e)}", 'error')
            messagebox.showerror(tr('error_msg'), str(e))
        
        finally:
            self.root.config(cursor='')
            self.update_progress(0)

if __name__ == "__main__":
    root = tk.Tk()
    app = Font2PGFConverter(root)
    root.mainloop()